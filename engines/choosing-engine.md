# בחירת מנוע — מדריך מעשי

סיכום ממצאים מניסויים עם כל מנוע, כולל ניתוח PDF ברמת content stream.
רלוונטי בעיקר לכתיבה **עברית ראשית עם מתמטיקה** (שיעורי בית, עבודות אקדמיות).

---

## השוואה מהירה

| מנוע | BiDi אוטומטי | בחירת טקסט ב-PDF | פונט David CLM | טבלאות | מהירות |
|------|-------------|-----------------|---------------|--------|--------|
| pdfLaTeX | ✗ — עטיפה ידנית | ✓ תקין | ✓ (חבילת TeX) | מסובך | מהיר מאוד |
| XeLaTeX | חלקי — מילים בודדות | ✓ תקין | ✓ (פונט מערכת) | סביר | בינוני |
| LuaLaTeX | ✓ מלא | ✗ שבור | ✓ (פונט מערכת) | ✓ | איטי |
| Typst | ✓ מובנה | ✓ תקין | ✓ (פונט מערכת) | ✓ | מהיר מאוד |

---

## בעיית בחירת הטקסט ב-LuaLaTeX — הסבר טכני

### מה קורה

כשמנסים לבחור טקסט עברי ב-PDF שיוצר LuaLaTeX, הספרות/תווים הראשון והאחרון בכל "ריצת כיוון" (run תחום על ידי פסיק, נקודה, רווח) אינם ניתנים לבחירה — הם מבודדים ממשק המשפט.

### למה זה קורה

ניתוח ה-content stream של ה-PDF חושף את הסיבה:

**LuaLaTeX** — כל מילה ב-object נפרד:
```
1 0 0 1 488.3 675.6 Tm [<שלום>]TJ
1 0 0 1 386.8 675.6 Tm [<,>]TJ
1 0 0 1 373.8 675.6 Tm [<עולם>]TJ
```

**XeLaTeX** — כל השורה ב-object אחד:
```
-230.8 -21.1 Td [<שלום> -516 <עולם> -516 <מה> -517 <שלומכם>]TJ
```

Babel's `bidi=basic` מכניס "direction-change nodes" בכל גבול כיווני — כולל סביב פסיקים ונקודות. כל node כזה פותח `Tm` (absolute position reset) חדש ב-PDF. התווים הצמודים לגבולות אלה נופלים ב-text object נפרד, ולכן viewer לא יכול לגשר עליהם בבחירה.

### מה לא עוזר

- `Renderer=Harfbuzz` — מייצר PDF זהה לחלוטין (נבדק: 62 bytes שונים, רק timestamp ו-ID)
- `\usepackage[unicode, pdfencoding=auto]{hyperref}` — ללא שינוי מבני
- `\directlua{pdf.setgentounicode(1)}` — ללא שינוי
- `bidi=default` עם LuaLaTeX — Babel מתעלם, מייצר content stream זהה
- `pdftotext` — **מצליח** לחלץ טקסט נכון, כי הוא ממיין לפי מיקום. הבעיה היא interactive selection בלבד.

### המסקנה

זו מגבלה ארכיטקטורית של `bidi=basic` ב-LuaLaTeX. אין workaround פשוט. [לא הוגש bug report רשמי נכון לפברואר 2026](https://github.com/latex3/babel/issues).

---

## המלצות לפי תרחיש

### שיעורי בית עם הרבה מתמטיקה

**מומלץ: pdfLaTeX**

הסיבה: רוב ה"אנגלית" נמצאת בתוך `$...$` (מצב מתמטיקה), שהוא מחוץ למערכת ה-BiDi לחלוטין. כלומר ל-`\L{...}` תצטרך רק לביטויים כגון "linear", "OLS", "bias" כשמופיעים כטקסט, לא כנוסחה — ואלה נדירים יחסית.

```latex
\usepackage[english,hebrew]{babel}
% \L{word} רק לביטויים אנגליים כטקסט
```

יתרונות:
- בחירת טקסט תקינה
- הכי מהיר לקומפילציה
- הפשוט ביותר לתחזוקה
- David CLM מגיע מובנה עם TeX Live

### עבודות עם הרבה פרוזה דו-שפתית

**מומלץ: XeLaTeX**

אם הטקסט כולל משפטים כמו "הפונקציה $f$ היא convex ולכן..." עם מילים אנגליות רבות **כטקסט** (לא כנוסחה), XeLaTeX חוסך את העטיפה הידנית של מילים בודדות.

```latex
\usepackage[english, hebrew, provide=*, bidi=default, layout=tabular]{babel}
\babelfont[hebrew]{rm}{David CLM}
```

יתרונות על pdfLaTeX:
- מילים בודדות באנגלית עוברות אוטומטית
- פונטי מערכת (גמישות)
- בחירת טקסט תקינה

חסרונות לעומת LuaLaTeX:
- BiDi חלקי בלבד (לא שורות שלמות)
- רשימות ממוספרות מתנהגות לא תמיד תקין

### כשהפלט הוא הדפסה בלבד (לא לקריאה דיגיטלית)

**מומלץ: LuaLaTeX**

אם אף פעם לא תבחר טקסט מה-PDF (מדפיס ישירות), LuaLaTeX הוא הבחירה הטובה ביותר: BiDi אוטומטי מלא, טבלאות תקינות, מתוחזק.

```latex
\usepackage[bidi=basic, layout=tabular]{babel}
\babelprovide[main, import]{hebrew}
\babelfont[hebrew]{rm}{David CLM}
```

**שים לב:** אל תשתמש ב-`luabidi` יחד עם `bidi=basic` — הן מתנגשות.
ראה [migration-from-luabidi.tex](luatex/migration-from-luabidi.tex).

### כתיבה מהירה, לא אקדמית

**מומלץ: Typst**

אם "המראה של LaTeX" פחות חשוב ונוחות הכתיבה היא העיקר.

---

## סיכום חד-שורתי

> מתמטיקה כבדה ← **pdfLaTeX**
> פרוזה דו-שפתית + בחירת טקסט ← **XeLaTeX**
> הדפסה בלבד + BiDi מלא ← **LuaLaTeX**
> כתיבה מהירה ← **Typst**
